{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% trans 'ëª©ì†Œë¦¬ ë§Œë“¤ê¸°' %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/makeVoice/makeVoice.css' %}?v=5" />
        <!-- Open Graph (SNS ê³µìœ ìš©) -->
    <meta property="og:title" content="GALATEA AI - ìŒì„± ëŒ€í™”í˜• ì±—ë´‡" />
    <meta property="og:description" content="ìì—°ìŠ¤ëŸ¬ìš´ ìŒì„± ëŒ€í™”í˜• AI ì±—ë´‡. ê³ ê°ê³¼ ì‚¬ëŒì²˜ëŸ¼ ëŒ€í™”í•˜ë©° ìƒë‹´ê³¼ ì•ˆë‚´ë¥¼ ì œê³µí•©ë‹ˆë‹¤." />
    <meta property="og:image" content="https://galatea.website/static/img/intro2.png">
    <meta property="og:url" content="https://galatea.website" />
    <meta property="og:type" content="website" />

    <!-- Meta Description (ê²€ìƒ‰ ê²°ê³¼ìš©) -->
    <meta name="description" content="ë¬¸ìë§Œ ì…ë ¥í•˜ëŠ” ì±—ë´‡ì€ ì´ì œ ê·¸ë§Œ! GALATEA AIëŠ” ìŒì„± ê¸°ë°˜ ëŒ€í™”í˜• AIë¡œ, ì‹¤ì œ ì‚¬ëŒì²˜ëŸ¼ ëŒ€í™” ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤. GALATEA AIëŠ” ë‹¨ìˆœí•œ ì±—ë´‡ì´ ì•„ë‹™ë‹ˆë‹¤. ìŒì„±ìœ¼ë¡œ ì‚¬ëŒì²˜ëŸ¼ ëŒ€í™”í•˜ë©°, ìì—°ìŠ¤ëŸ¬ìš´ ìƒë‹´Â·ì•ˆë‚´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì§€ê¸ˆ ë¬´ë£Œ ì²´í—˜ìœ¼ë¡œ ì§ì ‘ ê²½í—˜í•´ë³´ì„¸ìš”. ">

    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "GALATEA AI",
  "url": "https://www.galatea.website",
  "logo": "https://www.galatea.website/static/img/logo.png"
}
</script>

</head>
<body>
    <!-- Background Circles -->
    <div class="circle-bg circle-1"></div>
    <div class="circle-bg circle-2"></div>
    <div class="circle-bg circle-3"></div>
    <div class="circle-bg circle-4"></div>
    <div class="circle-bg circle-5"></div>

    <header>
        {% if not user.is_authenticated %}
            {% include "common/notLoginHeader.html" %}
        {% else %}
            {% include "common/loginHeader.html" %}
        {% endif %}
    </header>

    <div class="container">
        <div class="main-card">
            {% if error %}
                <div class="error-message">{{ error }}</div>
            {% endif %}

            {% if is_result %}
                <h1>ğŸ¤ {% trans 'AI ëª©ì†Œë¦¬ ìƒì„±' %}</h1>
                
                <h3>âœ¨ {% trans 'ìƒ˜í”Œ ë¯¸ë¦¬ë“£ê¸°' %}</h3>
                <div class="audio-preview-section">
                    <audio controls>
                        <source src="{{ preview_url }}" type="audio/mpeg" />
                        {% trans 'í˜„ì¬ ë¸Œë¼ìš°ì €ê°€ ìƒ˜í”Œ ê¸°ëŠ¥ì„ í—ˆìš©í•˜ì§€ ì•ŠìŒ' %}
                    </audio>
                    <div class="sample-id">{% trans 'ìƒ˜í”Œ ID' %}: {{ preview_id }}</div>
                </div>

                <div class="form-group">
                    <label for="voice_name">ğŸ·ï¸ {% trans 'ëª©ì†Œë¦¬ ì´ë¦„' %}:</label>
                    <input name="voice_name" id="voice_name" value="{{ voice_name }}" required placeholder="{% trans 'ë‚˜ë§Œì˜ íŠ¹ë³„í•œ ëª©ì†Œë¦¬ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”' %}" />
                </div>

                <div class="button-group">
                    <button id="final-create-btn" class="btn btn-primary" data-id="{{ preview_id }}">
                        <a href="{% url 'mypage:my_voice' %}" style="color: inherit; text-decoration: none;">ğŸ’¾ {% trans 'ëª©ì†Œë¦¬ ì €ì¥í•˜ê¸°' %}</a>
                    </button>
                    <button id="retry-btn" class="btn btn-tertiary">ğŸ”„ {% trans 'ë‹¤ì‹œ ë§Œë“¤ê¸°' %}</button>
                </div>

                <script>
                    // ì¿ í‚¤ì—ì„œ CSRF í† í° ì½ê¸° í•¨ìˆ˜
                    
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }

                    const csrftoken = getCookie('csrftoken');

                    document.getElementById('final-create-btn').addEventListener('click', function (event) {
                        event.preventDefault();  // ë²„íŠ¼ ì•ˆì˜ ë§í¬ ê¸°ë³¸ ë™ì‘ ë§‰ê¸°

                        const id = this.dataset.id;
                        const voiceName = document.getElementById("voice_name").value.trim();

                        if (!voiceName) {
                            alert("{% trans 'ëª©ì†Œë¦¬ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!' %}");
                            return;
                        }

                        fetch("{% url 'makeVoice:make_voice' %}", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/x-www-form-urlencoded',
                                'X-CSRFToken': csrftoken,
                            },
                            body: `generated_voice_id=${encodeURIComponent(id)}&voice_name=${encodeURIComponent(voiceName)}`
                        })
                        .then(res => {
                            if (!res.ok) throw new Error('ì„œë²„ ì‘ë‹µì´ ì •ìƒì ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                            return res.json();
                        })
                        .then(data => {
                            if (data.status === 'success') {
                                alert("ğŸ‰ {% trans 'ìµœì¢… ëª©ì†Œë¦¬ ìƒì„± ì™„ë£Œ! Voice ID:' %} " + data.voice_id);
                                // ì €ì¥ í›„ ë§ˆì´í˜ì´ì§€ ì´ë™ ì›í•˜ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
                                // window.location.href = "{% url 'mypage:my_voice' %}";
                            } else {
                                alert("âŒ ì˜¤ë¥˜: " + data.error);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert("âŒ {% trans 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' %}");
                        });
                    });

                    document.getElementById("retry-btn").addEventListener('click', function () {
                        if (confirm("ğŸ”„ {% trans 'ë‹¤ì‹œ ë§Œë“œì‹œê² ìŠµë‹ˆê¹Œ?\n\nì¬ìƒì„±ì‹œ ê¸°ì¡´ì˜ í† í°ì´ ì•„ë‹Œ ìƒˆë¡œìš´ í† í°ì´ ì°¨ê°ë©ë‹ˆë‹¤.\nëª©ì†Œë¦¬ëŠ” ë§ˆì´í˜ì´ì§€ì— ê·¸ëŒ€ë¡œ ì €ì¥ë©ë‹ˆë‹¤.' %}")) {
                            window.location.href = "{% url 'makeVoice:make_voice_page' %}";
                        }
                    });
                </script>

            {% else %}
                <p>{% trans 'ë‚˜ë§Œì˜ íŠ¹ë³„í•œ AI ëª©ì†Œë¦¬ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”! ì›í•˜ëŠ” ìŠ¤íƒ€ì¼ê³¼ í†¤ì„ ìì„¸íˆ ì„¤ëª…í•˜ë©´, ê·¸ì— ë§ëŠ” ë…íŠ¹í•œ ëª©ì†Œë¦¬ë¥¼ ìƒì„±í•´ë“œë¦½ë‹ˆë‹¤.' %}</p>

                <form method="POST" action="{% url 'makeVoice:sample_voice' %}" class="voice-creation-form">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="voice_prompt_input">ğŸ¨ {% trans 'ìŒì„± ìŠ¤íƒ€ì¼ í”„ë¡¬í”„íŠ¸' %}</label>
                        <textarea name="voice_prompt_input" id="voice_prompt_input" required
                            placeholder="{% trans 'ì›í•˜ëŠ” ëª©ì†Œë¦¬ì˜ íŠ¹ì§•ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”!&#10;&#10;ì˜ˆì‹œ:&#10;- ë”°ëœ»í•˜ê³  ì¹œê·¼í•œ ì—¬ì„± ëª©ì†Œë¦¬&#10;- ì°¨ë¶„í•˜ê³  ì§€ì ì¸ ë‚¨ì„± ëª©ì†Œë¦¬&#10;- í™œê¸°ì°¨ê³  ë°ì€ ì²­ë…„ ëª©ì†Œë¦¬&#10;- ì„±ìˆ™í•˜ê³  ì‹ ë¢°ê° ìˆëŠ” ëª©ì†Œë¦¬&#10;&#10;â€» í­ë ¥ì , ì„±ì ì¸ ë‚´ìš©ì€ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.' %}">{{ voice_prompt_input }}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="sample_text_input">ğŸ“ {% trans 'ìƒ˜í”Œ í…ìŠ¤íŠ¸' %}</label>
                        <textarea name="sample_text_input" id="sample_text_input" required
                            placeholder="{% trans 'ìƒì„±ë  ëª©ì†Œë¦¬ë¡œ ì½ì–´ë³¼ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.&#10;&#10;ìµœì†Œ 130ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš” (ì•½ 3~4ì¤„)&#10;&#10;ì˜ˆì‹œ:&#10;ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ì—¬ëŸ¬ë¶„ë§Œì„ ìœ„í•œ íŠ¹ë³„í•œ AI ëª©ì†Œë¦¬ì…ë‹ˆë‹¤. ë”°ëœ»í•œ ë§ˆìŒìœ¼ë¡œ ì—¬ëŸ¬ë¶„ê³¼ ì†Œí†µí•˜ë©°, ì–¸ì œë‚˜ ë„ì›€ì´ ë˜ëŠ” ì •ë³´ë¥¼ ì „ë‹¬í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ë„ ì¢‹ì€ í•˜ë£¨ ë˜ì„¸ìš”!' %}">{{ sample_text_input }}</textarea>
                    </div>

                    <div class="generate-container">
                        <button type="submit" class="btn generate-button">âœ¨ {% trans 'ìƒ˜í”Œ ìƒì„±í•˜ê¸°' %}</button>
                        <p style="margin-top: 20px; color: #888; font-size: 0.9rem;">
                            ğŸ’¡ {% trans 'íŒ: êµ¬ì²´ì ì´ê³  ìƒì„¸í•œ ì„¤ëª…ì¼ìˆ˜ë¡ ë” ì •í™•í•œ ëª©ì†Œë¦¬ê°€ ìƒì„±ë©ë‹ˆë‹¤! ë” ìì„¸í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ "ëŒ€ì‹  ë§Œë“¤ì–´ì¤˜!"ë¥¼ í´ë¦­í•˜ì„¸ìš”' %}
                        </p>
                    </div>
                </form>
                                        <button type="submit" id="auto_generate_btn" class="btn generate-button">ğŸ¤– {% trans 'ëŒ€ì‹  ë§Œë“¤ì–´ì¤˜' %}</button>

            {% endif %}
        </div>
    </div>

    <script>
        document.getElementById("auto_generate_btn").addEventListener("click", function(){
            const userPrompt = document.getElementById("voice_prompt_input").value.trim();
            const csrftoken = "{{ csrf_token }}";

            if (!userPrompt){
                alert("{% trans 'ë¨¼ì € ìŒì„± ìŠ¤íƒ€ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!' %}");
                return;
            }
            fetch("{% url 'auto_generate_prompt' %}", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body:JSON.stringify({prompt:userPrompt})
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success'){
                document.getElementById('voice_prompt_input').value = data.refined_prompt;
            alert("{% trans 'ìŒì„± í”„ë¡¬í”„íŠ¸ê°€ ì¢€ ë” êµ¬ì²´í™”ë˜ì—ˆìŠµë‹ˆë‹¤!' %}");
                } else {
                    alert("{% trans 'í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' %}");
                }
        })
        .catch(err => {
            console.error(err);
            alert("ì„œë²„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
        })
        })
    
    </script>
</body>
</html>
