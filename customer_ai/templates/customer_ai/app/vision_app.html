<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Vision & Voice í†µí•© ê²°ê³¼</title>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #0f0f23;
            color: #fff;
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }

        /* ì˜ìƒ ë°±ê·¸ë¼ìš´ë“œ */
        .video-background {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            z-index: 1;
        }

        .ai-video {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #webcam {
            position: absolute;
            top: 15px; left: 15px;
            width: 160px;
            height: 120px;
            border-radius: 12px;
            border: 2px solid rgba(139, 92, 246, 0.6);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            z-index: 2;
            object-fit: cover;
        }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(15,15,35,0.9);
            backdrop-filter: blur(8px);
            border-top: 1px solid rgba(139, 92, 246, 0.3);
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 3;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .vision-toggle, .record-btn {
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vision-toggle {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .vision-toggle.active {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .record-btn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            justify-content: center;
        }
        .record-btn.recording {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%,100% { box-shadow: 0 0 10px rgba(239,68,68,0.5); }
            50% { box-shadow: 0 0 25px rgba(239,68,68,0.8); }
        }

        .results-section {
            display: flex;
            justify-content: center;
            background: rgba(26,26,46,0.6);
            border-radius: 15px;
            padding: 12px;
        }

        .result-card {
            background: rgba(26,26,46,0.6);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 10px;
            font-size: 0.9rem;
            color: #e2e8f0;
            min-height: 60px;
            width: 100%;
            max-width: 480px;
        }

        .result-title {
            font-weight: 600;
            color: #8b5cf6;
            margin-bottom: 6px;
            font-size: 1rem;
        }

        #combined-result div {
            margin: 4px 0;
        }

        #combined-result b {
            color: #93c5fd;
        }

        @media (max-width: 768px) {
            #webcam { width: 120px; height: 90px; }
            .result-card { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="video-background">
        <video id="aiVideo" class="ai-video" autoplay muted loop>
            <source src="background.mp4" type="video/mp4">
        </video>
        <video id="webcam" autoplay playsinline muted></video>
    </div>

    <div class="control-panel">
        <div class="results-section">
            <div class="result-card">
                <div class="result-title"><i class="fas fa-brain"></i> í†µí•© ê²°ê³¼</div>
                <div id="combined-result">
                    <div><b>ğŸ§  ë¹„ì „:</b> ì¤€ë¹„ ì¤‘...</div>
                    <div><b>ğŸ¤ ìŒì„±:</b> ëŒ€ê¸° ì¤‘...</div>
                    <div><b>ğŸ¤– ì‘ë‹µ:</b> ëŒ€ê¸° ì¤‘...</div>
                </div>
            </div>
        </div>

        <div class="control-buttons">
            <button class="vision-toggle" id="visionToggle">ë¹„ì „ ëª¨ë“œ</button>
            <button class="record-btn" id="recordBtn">ğŸ¤</button>
        </div>
    </div>

    <script>
        const webcam = document.getElementById('webcam');
        const visionToggle = document.getElementById('visionToggle');
        const recordBtn = document.getElementById('recordBtn');
        let mediaRecorder, chunks = [];
        let latestVision = "ì¤€ë¹„ ì¤‘...";
        let latestVoice = "ëŒ€ê¸° ì¤‘...";
        let latestAI = "ëŒ€ê¸° ì¤‘...";
        let visionActive = false;

        function updateCombinedResult() {
            document.getElementById('combined-result').innerHTML = `
                <div><b>ğŸ§  ë¹„ì „:</b> ${latestVision}</div>
                <div><b>ğŸ¤ ìŒì„±:</b> ${latestVoice}</div>
                <div><b>ğŸ¤– ì‘ë‹µ:</b> ${latestAI}</div>
            `;
        }

        // ì›¹ìº  ì‹¤í–‰
        navigator.mediaDevices.getUserMedia({ video: true, audio: false })
            .then(stream => webcam.srcObject = stream)
            .catch(err => console.error("ì›¹ìº  ì˜¤ë¥˜:", err));

        // ë¹„ì „ ëª¨ë“œ í† ê¸€
        visionToggle.addEventListener('click', () => {
            visionActive = !visionActive;
            visionToggle.classList.toggle('active', visionActive);
            visionToggle.textContent = visionActive ? 'ë¹„ì „ ì¢…ë£Œ' : 'ë¹„ì „ ëª¨ë“œ';
            if (visionActive) sendFrameLoop();
        });

        // ë¹„ì „ í”„ë ˆì„ ì „ì†¡ (ì˜ˆì‹œ)
        async function sendFrameLoop() {
            if (!visionActive) return;
            latestVision = "ì¸ì‹ ì¤‘...";
            updateCombinedResult();

            // ì‹¤ì œ êµ¬í˜„ ì‹œ: ìº¡ì²˜í•œ í”„ë ˆì„ ì„œë²„ ì „ì†¡
            setTimeout(() => {
                latestVision = "ê³ ì–‘ì´ë¡œ ì¸ì‹ë¨ ğŸ±";
                updateCombinedResult();
                if (visionActive) setTimeout(sendFrameLoop, 2000);
            }, 1500);
        }

        // ìŒì„± ë…¹ìŒ ì‹œì‘
        recordBtn.addEventListener('click', async () => {
            if (recordBtn.classList.contains('recording')) {
                mediaRecorder.stop();
                recordBtn.classList.remove('recording');
                return;
            }
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                chunks = [];
                mediaRecorder.ondataavailable = e => chunks.push(e.data);
                mediaRecorder.onstop = async () => {
                    const blob = new Blob(chunks, { type: 'audio/webm' });
                    latestVoice = "ì¸ì‹ ì¤‘...";
                    updateCombinedResult();

                    // ì‹¤ì œ êµ¬í˜„ ì‹œ: ì„œë²„ë¡œ ì „ì†¡
                    setTimeout(() => {
                        latestVoice = "ì˜¤ëŠ˜ ë‚ ì”¨ ì–´ë•Œ?";
                        latestAI = "ì˜¤ëŠ˜ì€ ë§‘ê³  ë”°ëœ»í•©ë‹ˆë‹¤ â˜€ï¸";
                        updateCombinedResult();
                    }, 2000);
                };
                mediaRecorder.start();
                recordBtn.classList.add('recording');
            } catch (err) {
                console.error("ìŒì„± ë…¹ìŒ ì‹¤íŒ¨:", err);
            }
        });
    </script>
</body>
</html>
