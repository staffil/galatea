{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{% static 'css/home/llm_intro.css' %}">

<title>{% trans '마이페이지' %} - GALATEA</title>

</head>

<body>
<div class="glt2-container">
{% for item in llm_list %}
<div class="glt2-card">
    {% if item.llm_background_image %}
        <div class="glt2-bg" style="background-image: url('{{ item.llm_background_image.url }}');"></div>
    {% endif %}
    <div class="glt2-content" style="background:linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);">
        <div class="glt2-header">
            {% if item.llm_image %}
            <img src="{{ item.llm_image.url|default:'/static/images/default.png' }}" alt="{% trans 'LLM 이미지' %}">
            {% endif %}
            {% if user.is_authenticated and user != item.user %}
            <button class="glt2-like-btn" data-id="{{ item.id }}">
                {% if item.user_has_liked %}<span class="heart-filled"></span>{% else %}<span class="heart-empty"></span>{% endif %}
            </button>

            {% endif %}

        </div>
        <div class="glt2-title">{{ item.title }}</div>
        <div class="glt2-description">{{ item.description }}</div>
        <div class="glt2-stats">



            ❤️ {% trans "좋아요" %}: {{ item.llm_like_count }}
            👤 {% trans "팔로우" %}: {{ item.user.follow_count }}
        </div>
        <div class="glt2-user-info">
            {% if item.user.user_image %}
            <img src="{{ item.user.user_image.url }}" alt="">
            {% else %}
            <img src="{% static 'images/default_user.png' %}" alt="">
            {% endif %}
            <span style="color:#fff;">{{ item.user.username }}</span>
            {% if user.is_authenticated and user != item.user %}
            <button class="glt2-follow-btn" data-id="{{ item.user.id }}">
                {% if item.user_is_following_user %}{% trans "Following" %}{% else %}{% trans "Follow" %}{% endif %}
            </button>
            {% endif %}
        </div>
        <button class="glt2-chat-btn" onclick="window.location.href='/customer_ai/chat/{{ item.id }}/'">{% trans "대화하기" %}</button>
        <div class="glt2-genre-tags">
            {% for genre in item.genres.all %}
            <div class="glt2-genre-tag" style="background-color: {{ genre.color }};">{{ genre.name }}</div>
            {% empty %}
            <div class="glt2-genre-tag" style="background-color: #999;">{% trans "장르 없음" %}</div>
            {% endfor %}
        </div>
    </div>
</div>
{% endfor %}
</div>

<!-- 모달 -->
<div class="glt2-modal-overlay" id="glt2ModalOverlay">
    <div class="glt2-modal-card">
        <button class="glt2-modal-close" id="glt2ModalClose">&times;</button>
        <div class="glt2-modal-content" id="glt2ModalContent"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const modalOverlay = document.getElementById('glt2ModalOverlay');
    const modalContent = document.getElementById('glt2ModalContent');
    const modalClose = document.getElementById('glt2ModalClose');

    document.querySelectorAll('.glt2-card').forEach(card => {
        card.addEventListener('click', (e) => {
            if (e.target.closest('.glt2-follow-btn') || e.target.closest('.glt2-like-btn') || e.target.closest('.glt2-chat-btn')) return;

            const contentClone = card.querySelector('.glt2-content').cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(contentClone);

            modalOverlay.style.display = 'flex';

            // 모달 내부 버튼 활성화
            modalContent.querySelectorAll('.glt2-like-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const heart = btn.querySelector('span');
                    heart.classList.toggle('heart-filled');
                    heart.classList.toggle('heart-empty');
                });
            });
            modalContent.querySelectorAll('.glt2-follow-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.innerText = btn.innerText === '{% trans "Follow" %}' ? '{% trans "Following" %}' : '{% trans "Follow" %}';
                });
            });
        });
    });

    modalClose.addEventListener('click', () => {
        modalOverlay.style.display = 'none';
        modalContent.innerHTML = '';
    });

    modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) {
            modalOverlay.style.display = 'none';
            modalContent.innerHTML = '';
        }
    });
});



</script>
</body>
</html>