{% load static %} 
{% load i18n %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>{% trans "GALATEA - Chat with Celebrities" %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
    <link rel="icon" href="/static/img/favicon.ico" type="image/x-icon">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    height: 100%;
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) fixed;
}

body {
    height: 100%;
    min-height: 100%;
    font-family: 'Inter', 'Noto Sans KR', sans-serif;
    background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%) fixed;
    color: #ffffff;
    overflow-x: hidden;
}

/* 헤더 */
header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background: rgba(15, 15, 35, 0.95);
    border-bottom: 1px solid rgba(139, 92, 246, 0.2);
}

main {
    padding-top: 60px;
    min-height: 100vh;
}

/* 사이드바 토글 */
#sidebar-toggle {
    position: fixed;
    top: 80px;
    right: 20px;
    width: 45px;
    height: 45px;
    background: linear-gradient(135deg, #8b5cf6, #06b6d4);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 16px;
    cursor: pointer;
    z-index: 999;
    transition: all 0.3s ease;
    padding: 15px;
    margin-top: 30px;
}

#sidebar-content {
    position: fixed;
    top: 135px;
    right: 20px;
    background: linear-gradient(135deg, rgba(15,15,35,0.95), rgba(26,26,46,0.95));
    border: 1px solid rgba(139,92,246,0.2);
    border-radius: 12px;
    padding: 16px;
    min-width: 180px;
    z-index: 998;
    transition: all 0.3s ease;
}

#sidebar-content.collapsed {
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
}

.languageSelect label {
    color: #e2e8f0;
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 6px;
    display: block;
}

.languageSelect select {
    width: 100%;
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid rgba(139,92,246,0.3);
    background: rgba(139,92,246,0.1);
    color: #e2e8f0;
    font-size: 12px;
    margin-bottom: 8px;
}

.languageSelect button, .helpdesk a {
    display: block;
    width: 100%;
    padding: 6px 10px;
    margin-bottom: 6px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 12px;
    font-weight: 500;
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(139,92,246,0.3);
    background: linear-gradient(135deg, rgba(139,92,246,0.1), rgba(6,182,212,0.1));
    color: #e2e8f0;
    cursor: pointer;
}

/* 메인 네비게이션 */
.main-nav {
    display: flex;
    justify-content: center;
    gap: 10px;
    padding: 20px 10px;
    flex-wrap: wrap;
}

.nav-button {
    padding: 12px 20px;
    background: rgba(139, 92, 246, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 25px;
    color: #ffffff;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.nav-button.special {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
}

/* 뉴스 섹션 */
.news-section {
    margin: 20px 15px;
}

.news-container {
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 16px;
    overflow: hidden;
    position: relative;
}

.news-slider {
    display: flex;
    transition: transform 0.5s ease;
}

.news-slide {
    min-width: 100%;
    padding: 20px;
}

.news-slide img {
    width: 100%;
    max-height: 180px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 15px;
}

.news-content {
    text-align: left;
}

.news-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 10px;
}

.news-description {
    font-size: 0.95rem;
    color: #b8c5d1;
    line-height: 1.6;
    margin-bottom: 15px;
}

.news-link {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-decoration: none;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
}

.nav-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    background: rgba(139, 92, 246, 0.8);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 1.2rem;
    cursor: pointer;
    z-index: 10;
}

.nav-btn.prev { left: 10px; }
.nav-btn.next { right: 10px; }

.indicators {
    display: flex;
    justify-content: center;
    gap: 8px;
    padding: 15px;
}

.indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
}

.indicator.active {
    background: #8b5cf6;
    width: 24px;
    border-radius: 5px;
}

/* 섹션 타이틀 */
.section-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #ffffff;
    margin: 30px 0 20px 20px;
    text-align: left;
}

/* LLM 카드 */
.main-content {
    padding: 0 15px 30px;
}

.llm-container2 {
    margin-bottom: 30px;
}

.llm-row {
    margin-bottom: 15px;
}

.llm-cards-horizontal {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 10px 0;
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
}

.llm-cards-horizontal::-webkit-scrollbar {
    display: none;
}

.llm-card {
    flex: 0 0 200px;
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 16px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
}

.llm-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
}

.llm-image-container {
    height: 120px;
    overflow: hidden;
}

.llm-image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.llm-card-body {
    padding: 12px;
}

.llm-name {
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 8px;
}

.genre-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

.genre-tag {
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 0.75rem;
    color: white;
}

/* 인기 유저 */
.popular-users-section {
    padding: 0 15px 30px;
}

.users-list {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 10px 0;
    -webkit-overflow-scrolling: touch;
}

.users-list::-webkit-scrollbar {
    display: none;
}

.user-card {
    flex: 0 0 150px;
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 16px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.user-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
}

.user-avatar img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
}

.user-info {
    text-align: center;
}

.username {
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 5px;
}

.follower-count {
    font-size: 0.85rem;
    color: #b8c5d1;
}

/* 장르 */
.genre-container {
    padding: 0 15px 30px;
}

.genre-tags-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.genre-tag-box {
    position: relative;
    height: 120px;
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
}

.genre-tag-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.genre-tag-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    padding: 15px;
    color: white;
    font-weight: 600;
    text-align: center;
}

/* 전체보기 버튼 */
.view-all-btn {
    display: block;
    width: fit-content;
    margin: 20px auto;
    padding: 12px 30px;
    background: rgba(139, 92, 246, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 25px;
    color: #ffffff;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
}

.view-all-btn:hover {
    background: rgba(139, 92, 246, 0.3);
    transform: translateY(-2px);
}

/* 이벤트 */
.event_list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-bottom: 30px;
}

.event_list img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 12px;
}

/* 푸터 */
.footer {
    background: rgba(139, 92, 246, 0.1);
    border-top: 1px solid rgba(139, 92, 246, 0.2);
    padding: 20px;
    text-align: center;
    font-size: 0.85rem;
    color: #b8c5d1;
}

.company-name {
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 10px;
}

.info-line {
    margin: 5px 0;
}

/* 모달 스타일 */
.modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.85);
    z-index: 9999;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.modal-container {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    border: 1px solid rgba(139, 92, 246, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: white;
    font-size: 2rem;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
    line-height: 1;
}

.modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
}

.modal-content {
    padding: 20px;
}

.modal-header img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 12px;
    margin-bottom: 20px;
}

.modal-body h2 {
    font-size: 1.8rem;
    color: #ffffff;
    margin-bottom: 15px;
}

.modal-body p {
    color: #b8c5d1;
    line-height: 1.6;
    margin-bottom: 20px;
}

.modal-genres {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 25px;
}

.modal-actions {
    display: flex;
    gap: 10px;
}

.btn-chat {
    flex: 1;
    padding: 15px;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    text-decoration: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
}

.btn-chat:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
}

.follower-info {
    font-size: 1.1rem;
    color: #8b5cf6;
    font-weight: 600;
}

.glt2-follow-btn {
    padding: 12px 24px;
    background: rgba(139, 92, 246, 0.2);
    border: 1px solid rgba(139, 92, 246, 0.5);
    border-radius: 25px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.glt2-follow-btn:hover {
    background: rgba(139, 92, 246, 0.4);
    transform: translateY(-2px);
}

.glt2-follow-btn.following {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border-color: transparent;
}

@media (max-width: 576px) {
    .modal-container {
        max-width: 95%;
        border-radius: 16px;
    }

    .modal-header img {
        height: 180px;
    }

    .modal-body h2 {
        font-size: 1.5rem;
    }

    .modal-actions {
        flex-direction: column;
    }

    .section-title {
        font-size: 1.5rem;
        margin-left: 15px;
    }

    .llm-card {
        flex: 0 0 170px;
    }

    .user-card {
        flex: 0 0 130px;
    }

    .genre-tags-container {
        grid-template-columns: 1fr;
    }
}
</style>
</head>

<body>
    <header>
        {% if not user.is_authenticated %}
            {% include "common/notLoginHeader.html" %}
        {% else %}
            {% include "common/loginHeader.html" %}
        {% endif %}
    </header>

    <div id="sidebar-toggle" class="collapsed">&#9650;</div>

    <div id="sidebar-content" class="collapsed">
        <div class="languageSelect">
            <form action="{% url 'home:set_language' %}" method="post">
                {% csrf_token %}
                <label for="language-select">{% trans "언어 선택" %}</label>
                <select id="language-select" name="language">
                    {% for code, name in languages %}
                        <option value="{{ code }}" {% if code == LANGUAGE_CODE %}selected{% endif %}>{{ name }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" name="next" value="{{ request.get_full_path }}" />
                <button type="submit">Change Language</button>
            </form>
        </div>
        <div class="helpdesk">
            <a href="{% url 'helpdesk:Faq' %}" class="faq">FAQ</a>
            <a href="{% url 'helpdesk:request' %}" class="request">{% trans '요청하기' %}</a>
            <a href="{% url 'helpdesk:notice' %}" class="notice">{% trans '공지사항' %}</a>
        </div>
    </div>

    <main style="background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); margin-top: -40px; padding-bottom: 40px;">
        {% if user.is_authenticated %}
        <nav class="main-nav" role="navigation" aria-label="{% trans '주요 메뉴' %}" style="padding-top: 70px;">
            <a href="/payment/" class="nav-button">{% trans "결제하기" %}</a>
            <a href="/voice_all/" class="nav-button">{% trans "보이스 선택하기" %}</a>
            <a href="/image/" class="nav-button">{% trans "이미지 만들기" %}</a>
            <a href="/invite/" class="nav-button">{% trans "친구초대하기" %}</a>
            <a href="/customer_ai/ai_name" class="nav-button special">{% trans "AI 만들기⊕" %}</a>
        </nav>
        {% endif %}

        <!-- 뉴스 섹션 -->
        <div class="news-section">
            <div class="news-container" style="margin-top: 20px;">
                <div class="news-slider" id="newsSlider">
                    {% for news in news_list %}
                        <div class="news-slide">
                            {% if news.news_img %}
                                <img src="{{ news.news_img.url }}" alt="{{ news.title }}" loading="lazy">
                            {% endif %}
                            <div class="news-content">
                                <h3 class="news-title">{{ news.title }}</h3>
                                {% if news.news_description %}
                                    <p class="news-description">{{ news.news_description }}</p>
                                {% endif %}
                                {% if news.link %}
                                    <a href="{{ news.link }}" class="news-link" target="_blank">
                                        <span>{% trans "자세히 보기" %}</span>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    {% empty %}
                        <div class="news-slide">
                            <div class="news-placeholder">
                                <p>{% trans "등록된 뉴스가 없습니다." %}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                {% if news_list|length > 1 %}
                    <button class="nav-btn prev" onclick="slideNews(-1)">‹</button>
                    <button class="nav-btn next" onclick="slideNews(1)">›</button>
                    <div class="indicators">
                        {% for news in news_list %}
                            <div class="indicator {% if forloop.first %}active{% endif %}" onclick="goToSlide({{ forloop.counter0 }})"></div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- LLM 추천 -->
        <div class="main-content">
            <div class="llm-container2">
                <h2 class="section-title">{% trans '추천' %}</h2>
                
                <!-- 첫 번째 줄 -->
                <div class="llm-row">
                    <div class="llm-cards-horizontal">
                        {% for item in llm_list|slice:":10" %}
                        <div class="llm-card" onclick="openModal({{ item.id }}, '{{ item.title|escapejs }}', '{{ item.llm_image.url|default:'' }}')">
                            <div class="llm-card-body">
                                <div class="llm-image-container">
                                    {% if item.llm_image %}
                                        <img src="{{ item.llm_image.url }}" alt="{{ item.name }}" loading="lazy">
                                    {% else %}
                                        <img src="https://via.placeholder.com/220x120/F359DE/FFFFFF?text=No+Image" alt="기본 이미지" loading="lazy">
                                    {% endif %}
                                </div>
                                <div class="llm-name">{{ item.title }}</div>
                                <div class="genre-tags">
                                    {% for genre in item.genres.all %}
                                        <div class="genre-tag" style="background-color: {{ genre.color }};">{{ genre.name }}</div>
                                    {% empty %}
                                        <div class="genre-tag" style="background-color: #999;">장르 없음</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- 두 번째 줄 -->
                <div class="llm-row">
                    <div class="llm-cards-horizontal">
                        {% for item in llm_list|slice:"10:20" %}
                        <div class="llm-card" onclick="openModal({{ item.id }}, '{{ item.title|escapejs }}', '{{ item.llm_image.url|default:'' }}')">
                            <div class="llm-card-body">
                                <div class="llm-image-container">
                                    {% if item.llm_image %}
                                        <img src="{{ item.llm_image.url }}" alt="{{ item.name }}" loading="lazy">
                                    {% else %}
                                        <img src="https://via.placeholder.com/220x120/F359DE/FFFFFF?text=No+Image" alt="기본 이미지" loading="lazy">
                                    {% endif %}
                                </div>
                                <div class="llm-name">{{ item.title }}</div>
                                <div class="genre-tags">
                                    {% for genre in item.genres.all %}
                                        <div class="genre-tag" style="background-color: {{ genre.color }};">{{ genre.name }}</div>
                                    {% empty %}
                                        <div class="genre-tag" style="background-color: #999;">장르 없음</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- 세 번째 줄 -->
                <div class="llm-row">
                    <div class="llm-cards-horizontal">
                        {% for item in llm_list|slice:"20:30" %}
                        <div class="llm-card" onclick="openModal({{ item.id }}, '{{ item.title|escapejs }}', '{{ item.llm_image.url|default:'' }}')">
                            <div class="llm-card-body">
                                <div class="llm-image-container">
                                    {% if item.llm_image %}
                                        <img src="{{ item.llm_image.url }}" alt="{{ item.name }}" loading="lazy">
                                    {% else %}
                                        <img src="https://via.placeholder.com/220x120/F359DE/FFFFFF?text=No+Image" alt="기본 이미지" loading="lazy">
                                    {% endif %}
                                </div>
                                <div class="llm-name">{{ item.title }}</div>
                                <div class="genre-tags">
                                    {% for genre in item.genres.all %}
                                        <div class="genre-tag" style="background-color: {{ genre.color }};">{{ genre.name }}</div>
                                    {% empty %}
                                        <div class="genre-tag" style="background-color: #999;">장르 없음</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- 네 번째 줄 -->
                <div class="llm-row">
                    <div class="llm-cards-horizontal">
                        {% for item in llm_list|slice:"30:40" %}
                        <div class="llm-card" onclick="openModal({{ item.id }}, '{{ item.title|escapejs }}', '{{ item.llm_image.url|default:'' }}')">
                            <div class="llm-card-body">
                                <div class="llm-image-container">
                                    {% if item.llm_image %}
                                        <img src="{{ item.llm_image.url }}" alt="{{ item.name }}" loading="lazy">
                                    {% else %}
                                        <img src="https://via.placeholder.com/220x120/F359DE/FFFFFF?text=No+Image" alt="기본 이미지" loading="lazy">
                                    {% endif %}
                                </div>
                                <div class="llm-name">{{ item.title }}</div>
                                <div class="genre-tags">
                                    {% for genre in item.genres.all %}
                                        <div class="genre-tag" style="background-color: {{ genre.color }};">{{ genre.name }}</div>
                                    {% empty %}
                                        <div class="genre-tag" style="background-color: #999;">장르 없음</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                
                <a href="{% url 'home:llm_section' %}" class="view-all-btn">{% trans '전체 보기' %}</a>
            </div>
        </div>

        <!-- 인기있는 팔로워 -->
        <div class="popular-users-section">
            <h2 class="section-title">{% trans '인기 있는 팔로워' %}</h2>
            <div class="users-list">
                {% for user in total_follow_count %}
                <div class="user-card" onclick="openUserModal({{ user.id }}, '{{ user.nickname|escapejs }}', '{{ user.user_image.url|default:'' }}', '{{ user.follower_count }}')">
                    <div class="user-avatar">
                        {% if user.user_image %}
                            <img src="{{ user.user_image.url }}" alt="{{ user.username }}" loading="lazy">
                        {% else %}
                            <img src="{% static 'images/default_user.png' %}" alt="" loading="lazy">
                        {% endif %}
                    </div>
                    <div class="user-info">
                        <h3 class="username">{{ user.nickname }}</h3>
                        <span class="follower-count">{{ user.follower_count }} {% trans "팔로워" %}</span>
                    </div>
                </div>
                {% empty %}
                <div class="empty-message">
                    <p>{% trans "아직 팔로우한 유저가 없습니다." %}</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- 이벤트 -->
        <div class="popular-users-section">
            <h2 class="section-title">{% trans '이벤트' %}</h2>
            <div class="event_list">
                {% for gift in gift_list %}
                    {% if gift.gift_img %}
                        <img src="{{ gift.gift_img.url }}" alt="" loading="lazy">
                    {% else %}
                        <img src="{% static 'images/default_user.png' %}" alt="" loading="lazy">
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- 장르 섹션 -->
        <div class="main-content">
            <div class="genre-container" style="padding: 20px;">
                <h2 class="section-title">{% trans "장르" %}</h2>
                <div class="genre-tags-container">
                    {% for genre in genre_list|slice:":8" %}
                    <a href="{% url 'home:genres_detail' genre.id %}">
                        <div class="genre-tag-box">
                            {% if genre.genre_image %}
                                <img src="{{ genre.genre_image.url }}" alt="{{ genre.name }}" loading="lazy">
                            {% else %}
                                <img src="{% static 'images/default_genre.png' %}" alt="{{ genre.name }}" loading="lazy">
                            {% endif %}
                            <div class="genre-tag-overlay">{{ genre.name }}</div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
                <a href="{% url 'home:genre_all' %}" class="view-all-btn">{% trans '전체 보기' %}</a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="company-name">갈라테이아</div>
            <div class="info-line">사업자번호: 309-04-66659 | 대표자명: 김충희 | 연락처: 010-3161-5706 | email: kimc570612@gmail.com</div>
            <div class="info-line">주소: 경기도 안산시 단원구 광덕1로 80</div>
        </div>
    </footer>

    <!-- 모달 HTML -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-container">
            <button class="modal-close" onclick="closeModal()">×</button>
            <div id="modalContent" class="modal-content"></div>
        </div>
    </div>

<script>
    const LANGUAGE_CODE = "{{ LANGUAGE_CODE }}";
    const USER_ID = "{{ user.id }}";

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // 높이 강제 설정
    function fixHeight() {
        const vh = window.innerHeight;
        document.documentElement.style.height = vh + 'px';
        document.body.style.height = 'auto';
    }
    
    fixHeight();
    window.addEventListener('resize', fixHeight);
    window.addEventListener('orientationchange', fixHeight);

    // 사이드바 토글
    const toggleBtn = document.getElementById('sidebar-toggle');
    const sidebarContent = document.getElementById('sidebar-content');

    toggleBtn.addEventListener('click', () => {
        const collapsed = sidebarContent.classList.contains('collapsed');
        sidebarContent.classList.toggle('collapsed');
        toggleBtn.classList.toggle('collapsed');
        toggleBtn.classList.toggle('expanded');
        toggleBtn.innerHTML = collapsed ? '&#9660;' : '&#9650;';
    });

    // 뉴스 슬라이더
    let currentSlide = 0;
    const slides = document.querySelectorAll('.news-slide');
    const indicators = document.querySelectorAll('.indicator');
    const slider = document.getElementById('newsSlider');

    function slideNews(direction) {
        if (slides.length <= 1) return;
        currentSlide += direction;
        if (currentSlide >= slides.length) currentSlide = 0;
        else if (currentSlide < 0) currentSlide = slides.length - 1;
        updateSlider();
    }

    function goToSlide(index) {
        if (slides.length <= 1) return;
        currentSlide = index;
        updateSlider();
    }

    function updateSlider() {
        if (!slider) return;
        slider.style.transform = `translateX(-${currentSlide * 100}%)`;
        indicators.forEach((indicator, index) => {
            indicator.classList.toggle('active', index === currentSlide);
        });
    }

    if (slides.length > 1) {
        setInterval(() => slideNews(1), 5000);
    }

    // 모달 관련
    const modalOverlay = document.getElementById('modalOverlay');
    const modalContent = document.getElementById('modalContent');

    function openModal(llmId, title, imgSrc) {
        modalContent.innerHTML = `
            <div class="modal-header">
                <img src="${imgSrc || '/static/images/default.png'}" alt="${title}">
            </div>
            <div class="modal-body">
                <h2>${title}</h2>
                <div class="modal-actions">
                    <a href="/chat/${llmId}/" class="btn-chat">{% trans "채팅하기" %}</a>
                </div>
            </div>
        `;
        modalOverlay.style.display = 'flex';
    }

    function openUserModal(userId, nickname, imgSrc, followerCount) {
        modalContent.innerHTML = `
            <div class="modal-header">
                <img src="${imgSrc || '/static/images/default_user.png'}" alt="${nickname}">
            </div>
            <div class="modal-body">
                <h2>${nickname}</h2>
                <p class="follower-info">${followerCount} {% trans "팔로워" %}</p>
                <div class="modal-actions">
                    <button class="glt2-follow-btn" data-id="${userId}" onclick="event.stopPropagation()">
                        {% trans "Follow" %}
                    </button>
                </div>
            </div>
        `;
        modalOverlay.style.display = 'flex';
    }

    function closeModal() {
        modalOverlay.style.display = 'none';
        modalContent.innerHTML = '';
    }

    modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) closeModal();
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modalOverlay.style.display === 'flex') {
            closeModal();
        }
    });

    // 팔로우 토글
    document.addEventListener('click', (e) => {
        const followBtn = e.target.closest('.glt2-follow-btn');
        if (!followBtn) return;

        const userId = followBtn.dataset.id;
        if (!userId) return;

        fetch("{% url 'home:toggle_follow' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": getCookie('csrftoken'),
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: `user_id=${encodeURIComponent(userId)}`
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'follow') {
                followBtn.textContent = '{% trans "Following" %}';
                followBtn.classList.add('following');
            } else if (data.status === 'unfollow') {
                followBtn.textContent = '{% trans "Follow" %}';
                followBtn.classList.remove('following');
            } else {
                alert(data.message);
            }
        })
        .catch(err => console.error('팔로우 토글 오류:', err));
    });
</script>

</body>
</html>