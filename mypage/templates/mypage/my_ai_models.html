{% load static %} 
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" style="background-color: #3b0d69;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans '마이페이지' %} - GALATEA</title>

    <link rel="stylesheet" href="{% static 'css/mypage/my_ai_models.css' %}?v={{ STATIC_VERSION }}">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
</head>
<body>

    <!-- 배경 원형 효과 -->
    <div class="circle-bg circle-1"></div>
    <div class="circle-bg circle-2"></div>
    <div class="circle-bg circle-3"></div>
    <div class="circle-bg circle-4"></div>
    <div class="circle-bg circle-5"></div>

    <!-- 햄버거 메뉴 버튼 -->
    <button class="menu-toggle" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
    </button>
    <div class="sidebar-overlay" onclick="closeSidebar()"></div>

    {% include "common/sidebar.html" %}

    <div class="main-content">
        <div class="ai-config-container">
            <!-- 좌측: 이미지, 이름(select), 프롬프트 -->
            <div class="left-section">
                <div class="sidebar-profile">
                    <img id="llmImage" 
                         src="{% if llm_list|length > 0 and llm_list.0.llm_image %}{{ llm_list.0.llm_image.url }}{% endif %}" 
                         alt="{% trans 'AI 이미지' %}"/>
                    <p id="noImageText" style="display: none; color: white;">{% trans '생성된 이미지가 없습니다.' %}</p>
                </div>
                <select id="llmSelect" name="llm_id" onchange="updatePromptAndVoice()">
                    {% for llm in llm_list %}
                    <option
                        value="{{ llm.id }}"
                        data-prompt="{{ llm.prompt|escape }}"
                        data-voice-id="{{ llm.voice.voice_id }}"
                        data-language="{{ llm.language }}"
                        data-stability="{{ llm.stability }}"
                        data-speed="{{ llm.speed }}"
                        data-style="{{ llm.style }}"
                        data-temperature="{{ llm.temperature }}"
                        data-model="{{ llm.model }}"
                        {% if llm.llm_image %}data-llm-image="{{ llm.llm_image.url }}"{% endif %}
                    >
                        {{ llm.name }}
                    </option>
                    {% endfor %}
                </select>
                <div class="prompt-section">
                    <label>{% trans '프롬프트' %}</label>
                    <textarea class="prompt-textarea" id="promptDisplay" readonly></textarea>
                </div>
            </div>

            <!-- 우측: 슬라이더, 언어, voice -->
            <div class="right-section">
                <div class="language-group">
                    <label>{% trans '언어' %}</label>
                    <div class="language-description">{% trans '언어를 선택해주세요' %}</div>
                    <div class="language-selector" id="languageDisplay">US-en</div>
                </div>
                <div class="slider-container">
                    <div class="slider-label">{% trans '안정감' %}</div>
                    <input class="text" id="stabilitySlider" />
                    <span id="stabilityValue">0.5</span>
                </div>
                <div class="slider-container">
                    <div class="slider-label">{% trans '음성 속도' %}</div>
                    <input class="text" id="speedSlider" />
                    <span id="speedValue">0.5</span>
                </div>
                <div class="slider-container">
                    <div class="slider-label">{% trans '목소리 스타일' %}</div>
                    <input class="text" id="styleSlider" />
                    <span id="styleValue">0.5</span>
                </div>
                <div class="slider-container">
                    <div class="slider-label">{% trans '창의성' %}</div>
                    <input class="text" id="temperatureSlider" />
                    <span id="temperatureValue">0.5</span>
                </div>
                <div class="voice-section">
                    <label>Voice id</label>
                    <input type="text" class="voice-id-input" id="voiceIdDisplay" readonly />
                </div>
            </div>

            <!-- 하단 버튼 -->
            <div class="bottom-section">
                <a href="{% url 'customer_ai:chat_view' llm.id %}" class="action-button">{% trans '대화하기' %}</a>
                <a href="{% url 'mypage:my_ai_models_update' llm.id %}" class="action-button">{% trans '수정하기' %}</a>
                <a href="{% url 'mypage:my_ai_models_delete' llm.id %}" class="action-button delete-button" onclick="return confirm('{% trans "해당 AI를 삭제하시겠습니까?" %}')">{% trans '삭제하기' %}</a>
                {% if llm.is_public %}
                    <a href="{% url 'distribute:distribute' llm.id %}" class="action-button">{% trans '공유한 AI 수정하기' %}</a>
                {% else %}
                    <a href="{% url 'distribute:distribute' llm.id %}" class="action-button">{% trans '공유하기' %}</a>
                {% endif %}
            </div>

            <!-- Hidden inputs -->
            <input type="hidden" id="promptInput" readonly />
            <input type="hidden" id="voiceIdInput" readonly />
            <input type="hidden" id="languageInput" readonly />
            <input type="hidden" id="stabilityInput" readonly />
            <input type="hidden" id="speedInput" readonly />
            <input type="hidden" id="styleInput" readonly />
            <input type="hidden" id="temperatureInput" readonly />
            <input type="hidden" id="modelInput" readonly />
        </div>
    </div>

    <script src="{% static 'js/sidebar.js' %}"></script>
    <script>
        // JS 기능 그대로 유지
        function initializeUIWithCurrentLlm() {
            const initialLlm = {
                id: "{{ llm.id|default:''|escapejs }}",
                prompt: "{{ llm.prompt|default:''|escapejs }}",
                voiceId: "{% if llm.voice %}{{ llm.voice.voice_id|default:''|escapejs }}{% else %}{% endif %}",
                language: "{{ llm.language|default:''|escapejs }}",
                stability: "{{ llm.stability|default:0.5|escapejs }}",
                speed: "{{ llm.speed|default:0.5|escapejs }}",
                style: "{{ llm.style|default:0.5|escapejs }}",
                temperature: "{{ llm.temperature|default:0.5|escapejs }}",
                model: "{{ llm.model|default:''|escapejs }}",
                llmImage: "{% if llm.llm_image %}{{ llm.llm_image.url }}{% else %}{% endif %}"
            };

            const llmImageElem = document.getElementById("llmImage");
            const noImageText = document.getElementById("noImageText");
            if (initialLlm.llmImage) {
                llmImageElem.src = initialLlm.llmImage;
                llmImageElem.style.display = "block";
                noImageText.style.display = "none";
            } else {
                llmImageElem.style.display = "none";
                noImageText.style.display = "block";
            }

            document.getElementById("promptInput").value = initialLlm.prompt;
            document.getElementById("promptDisplay").value = initialLlm.prompt;
            document.getElementById("voiceIdInput").value = initialLlm.voiceId;
            document.getElementById("voiceIdDisplay").value = initialLlm.voiceId;
            document.getElementById("languageInput").value = initialLlm.language;
            document.getElementById("languageDisplay").textContent = initialLlm.language;
            document.getElementById("stabilityInput").value = initialLlm.stability;
            document.getElementById("stabilitySlider").value = initialLlm.stability;
            document.getElementById("stabilityValue").textContent = initialLlm.stability;
            document.getElementById("speedInput").value = initialLlm.speed;
            document.getElementById("speedSlider").value = initialLlm.speed;
            document.getElementById("speedValue").textContent = initialLlm.speed;
            document.getElementById("styleInput").value = initialLlm.style;
            document.getElementById("styleSlider").value = initialLlm.style;
            document.getElementById("styleValue").textContent = initialLlm.style;
            document.getElementById("temperatureInput").value = initialLlm.temperature;
            document.getElementById("temperatureSlider").value = initialLlm.temperature;
            document.getElementById("temperatureValue").textContent = initialLlm.temperature;
            document.getElementById("modelInput").value = initialLlm.model;
            document.getElementById("modelDisplay").textContent = initialLlm.model;

            const llmSelect = document.getElementById("llmSelect");
            if (llmSelect && initialLlm.id) {
                for (let i = 0; i < llmSelect.options.length; i++) {
                    if (llmSelect.options[i].value === initialLlm.id) {
                        llmSelect.selectedIndex = i;
                        break;
                    }
                }
            }
        }

        function updatePromptAndVoice() {
            const llmSelect = document.getElementById("llmSelect");
            const selectedOption = llmSelect.options[llmSelect.selectedIndex];
            const selectedLlmId = selectedOption.value;
            const currentPath = window.location.pathname;
            const newUrl = currentPath.replace(/\/my_ai_models\/(\d+)\/?$/, `/my_ai_models/${selectedLlmId}/`);
            if (window.location.pathname !== newUrl) window.location.href = newUrl;
            document.getElementById("promptDisplay").value = selectedOption.dataset.prompt || "";

        }

        function setupSliderListeners() {
            document.getElementById("stabilitySlider").oninput = function () {
                document.getElementById("stabilityValue").textContent = this.value;
                document.getElementById("stabilityInput").value = this.value;
            };
            document.getElementById("speedSlider").oninput = function () {
                document.getElementById("speedValue").textContent = this.value;
                document.getElementById("speedInput").value = this.value;
            };
            document.getElementById("styleSlider").oninput = function () {
                document.getElementById("styleValue").textContent = this.value;
                document.getElementById("styleInput").value = this.value;
            };
            document.getElementById("temperatureSlider").oninput = function () {
                document.getElementById("temperatureValue").textContent = this.value;
                document.getElementById("temperatureInput").value = this.value;
            };
        }

        window.onload = function () {
            initializeUIWithCurrentLlm();
            setupSliderListeners();
        };
    </script>

</body>
</html>