"use strict";var __createBinding=Object.create?function(r,e,o,t){t===void 0&&(t=o);var n=Object.getOwnPropertyDescriptor(e,o);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[o]}}),Object.defineProperty(r,t,n)}:function(r,e,o,t){t===void 0&&(t=o),r[t]=e[o]},__setModuleDefault=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e},__importStar=function(){var r=function(e){return r=Object.getOwnPropertyNames||function(o){var t=[];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[t.length]=n);return t},r(e)};return function(e){if(e&&e.__esModule)return e;var o={};if(e!=null)for(var t=r(e),n=0;n<t.length;n++)t[n]!=="default"&&__createBinding(o,e,t[n]);return __setModuleDefault(o,e),o}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.FloatingTooltip=void 0;const jsx_runtime_1=require("react/jsx-runtime"),index_js_1=require("../../../../interactions/rally/index.js"),index_js_2=require("../../../../core/index.js"),Paragraph=__importStar(require("../../../paragraph/index.js")),react_1=require("react"),react_native_1=require("react-native"),TooltipContext_js_1=require("../../contexts/TooltipContext.js"),useAnchorPosition_js_1=require("../../hooks/useAnchorPosition.js"),useOnPressOutside_js_1=require("../../hooks/useOnPressOutside.js"),mergeRefs_js_1=require("../../utils/mergeRefs.js"),Anchor_js_1=require("./Anchor.js"),TooltipBase_js_1=require("./TooltipBase.js");function measure(r){return new Promise(e=>{r.measure((o,t,n,s)=>{e({width:n,height:s})})})}exports.FloatingTooltip=(0,react_1.forwardRef)(function({open:e,children:o,...t},n){const{targetRef:s}=(0,TooltipContext_js_1.useTooltip)(),a=o.ref,l=(0,react_1.cloneElement)(o,{...o.props,collapsable:!1,onPress:()=>{t.onChildrenPress?.(),o.props?.onPress?.()},ref:a!=null?(0,mergeRefs_js_1.mergeRefs)(a,s):s});return(0,jsx_runtime_1.jsxs)(react_native_1.View,{style:{position:"relative",zIndex:9e3},children:[l,(0,jsx_runtime_1.jsx)(index_js_1.AnimateRallyPresence,{children:e&&(0,jsx_runtime_1.jsx)(react_native_1.View,{style:[react_native_1.StyleSheet.absoluteFill,{width:react_native_1.Dimensions.get("window").width}],pointerEvents:"box-none",children:(0,jsx_runtime_1.jsx)(FloatingTooltipContent,{ref:n,...t})})})]})});const FloatingTooltipContent=(0,react_1.forwardRef)(function({message:e,messageAlign:o,placement:t,contentPositionByRatio:n,size:s="medium",motion:a,onPress:l,onPressOutside:y},x){const u=(0,react_1.useRef)(null),p=(0,index_js_2.useAdaptive)(),{targetRef:g,offset:c}=(0,TooltipContext_js_1.useTooltip)(),[f,P]=(0,react_1.useState)(null),[h,b]=(0,react_1.useState)(null),i=(0,react_1.useMemo)(()=>(0,TooltipBase_js_1.getTooltipStyle)(s),[s]),w=(0,mergeRefs_js_1.mergeRefs)(x,u),v=(0,useAnchorPosition_js_1.useAnchorPosition)({anchorPositionByRatio:n,anchorWidth:i.anchorWidth,tooltipWidth:h?.width??0,size:s});return(0,useOnPressOutside_js_1.useOnPressOutside)({ref:u,onPressOutside:y}),(0,react_1.useEffect)(()=>{function d(){const _=g?.current,j=u.current;_!=null&&j!=null&&c!=null&&(async()=>{const{width:m,height:O}=await measure(_),{width:R,height:T}=await measure(j),q=m/2-R/2,A=t==="top"?-T-c-i.anchorHeight:O+i.anchorHeight+c;P({left:q,top:A})})()}requestAnimationFrame(()=>{d()})},[g,t,i,c]),f==null||h==null?(0,jsx_runtime_1.jsx)(react_native_1.Pressable,{ref:w,collapsable:!1,pointerEvents:"box-only",style:{opacity:0,position:"absolute",backgroundColor:p.floatBackground,borderRadius:i.borderRadius,paddingHorizontal:i.paddingHorizontal/2,paddingVertical:i.paddingVertical/2},onLayout:d=>{b(d.nativeEvent.layout)},onPress:l,children:(0,jsx_runtime_1.jsxs)(react_native_1.View,{children:[(0,jsx_runtime_1.jsx)(react_native_1.View,{style:{position:"absolute",width:i.anchorWidth,height:i.anchorHeight},children:(0,jsx_runtime_1.jsx)(Anchor_js_1.Anchor,{size:s})}),(0,jsx_runtime_1.jsx)(Paragraph.Text,{typography:i.typography,color:p.grey800,fontWeight:i.fontWeight,children:e})]})}):(0,jsx_runtime_1.jsx)(TooltipBase_js_1.TooltipBase,{ref:u,size:s,placement:t,messageAlign:o,message:e,motion:a,left:f.left,top:f.top,contentHeight:h.height,anchorMarginLeft:v,onPress:l})});
