"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EditableRating=void 0;const jsx_runtime_1=require("react/jsx-runtime"),react_native_svg_1=require("@granite-js/native/react-native-svg"),tds_easings_1=require("@toss/tds-easings"),react_1=require("react"),react_native_1=require("react-native"),index_js_1=require("../../core/index.js"),index_js_2=require("../../interactions/animated/index.js"),generateHapticFeedback_js_1=require("../../native/generateHapticFeedback.js"),index_js_3=require("../icon/private/index.js"),useA11yMode_js_1=require("./useA11yMode.js"),AnimatedIcon=index_js_2.Animated.createAnimatedComponent(index_js_3.SvgIcon),EditableRatingItem=(0,react_1.forwardRef)(function({size:r,name:v,active:y,disabledColor:i,idleColor:A,activeColor:c,disabled:j,forwardedRef:x,style:p,...h},M){const a=(0,react_1.useRef)(new index_js_2.Animated.Value(1)).current,o=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,f=(0,react_1.useRef)(new index_js_2.Animated.Value(1)).current,l=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,d=(0,react_1.useRef)(new index_js_2.Animated.Value(y?1:0)).current,S=d.interpolate({inputRange:[0,1],outputRange:[A,c]});(0,react_1.useEffect)(()=>{index_js_2.Animated.spring(d,{toValue:y?1:0,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start()},[y,d]);const u=(0,react_1.useCallback)(()=>{a.setValue(1),index_js_2.Animated.sequence([index_js_2.Animated.spring(a,{toValue:1.1,useNativeDriver:!1,...tds_easings_1.spring.rapid}),index_js_2.Animated.spring(a,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.quick})]).start()},[a]),g=(0,react_1.useCallback)(()=>{a.setValue(1),index_js_2.Animated.spring(a,{toValue:.9,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start()},[a]),k=(0,react_1.useCallback)(()=>{index_js_2.Animated.spring(d,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start(),index_js_2.Animated.spring(l,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick}).start()},[d,l]),R=(0,react_1.useCallback)(()=>{index_js_2.Animated.spring(l,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start(),index_js_2.Animated.spring(d,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.rapid}).start()},[d,l]),V=(0,react_1.useCallback)(()=>{index_js_2.Animated.spring(o,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick}).start()},[o]),m=(0,react_1.useCallback)(()=>{f.setValue(1),index_js_2.Animated.sequence([index_js_2.Animated.spring(f,{toValue:1.1,useNativeDriver:!1,...tds_easings_1.spring.rapid}),index_js_2.Animated.spring(f,{toValue:1,useNativeDriver:!1,...tds_easings_1.spring.quick})]).start(),index_js_2.Animated.sequence([index_js_2.Animated.spring(o,{toValue:.5,useNativeDriver:!1,...tds_easings_1.spring.rapid}),index_js_2.Animated.spring(o,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick})]).start(),index_js_2.Animated.spring(l,{toValue:0,useNativeDriver:!1,...tds_easings_1.spring.quick}).start()},[f,o,l]);return(0,react_1.useImperativeHandle)(M,()=>({expandMotion:u,shrinkMotion:g,activeMotion:R,inactiveMotion:k,touchDownMotion:V,touchUpMotion:m}),[R,u,k,g,V,m]),y&&j?(0,jsx_runtime_1.jsx)(react_native_1.View,{ref:x,pointerEvents:"none",style:[{opacity:.3},p],...h,children:(0,jsx_runtime_1.jsx)(AnimatedIcon,{name:v,size:r,color:c})}):j?(0,jsx_runtime_1.jsx)(react_native_1.View,{ref:x,pointerEvents:"none",style:p,...h,children:(0,jsx_runtime_1.jsx)(index_js_3.SvgIcon,{name:v,size:r,color:i})}):(0,jsx_runtime_1.jsxs)(index_js_2.Animated.View,{ref:x,pointerEvents:"none",style:[Position.relative,{transform:[{scale:a}]},p],...h,children:[(0,jsx_runtime_1.jsx)(index_js_2.Animated.View,{style:[ZIndex[1],Position.overlap,{opacity:o,width:r,height:r,transform:[{scale:f}]}],children:(0,jsx_runtime_1.jsxs)(react_native_svg_1.Svg,{height:r,width:r,children:[(0,jsx_runtime_1.jsx)(react_native_svg_1.Defs,{children:(0,jsx_runtime_1.jsxs)(react_native_svg_1.RadialGradient,{id:"grad",cx:"50%",cy:"50%",rx:"50%",ry:"50%",fx:"50%",fy:"50%",children:[(0,jsx_runtime_1.jsx)(react_native_svg_1.Stop,{offset:"0%",stopColor:c,stopOpacity:"1"}),(0,jsx_runtime_1.jsx)(react_native_svg_1.Stop,{offset:"100%",stopColor:c,stopOpacity:"0"})]})}),(0,jsx_runtime_1.jsx)(react_native_svg_1.Circle,{cx:r/2,cy:r/2,r:r/2,fill:"url(#grad)"})]})}),(0,jsx_runtime_1.jsx)(AnimatedIcon,{name:v,size:r,color:S,style:ZIndex[2]}),(0,jsx_runtime_1.jsx)(AnimatedIcon,{name:v,size:r,color:"rgba(0,0,0,0.1)",style:[ZIndex[3],Position.overlap,{opacity:l}]})]})}),GapBySize={medium:8,large:6,big:4},ItemSizeBySize={medium:24,large:32,big:40};exports.EditableRating=(0,react_1.forwardRef)(function({max:b=5,size:r="large",gap:v=GapBySize[r],activeColor:y,value:i,onValueChange:A,disabled:c=!1,style:j,accessibilityLabel:x="\uBCC4\uC810\uD3C9\uAC00",accessibilityValueText:p=`${b}\uC810 \uB9CC\uC810 \uC911 ${i}\uC810`,...h},M){const a=(0,useA11yMode_js_1.useScreenReaderMode)(),o=(0,index_js_1.useAdaptive)(),f=y??o.yellow400,l=o.greyOpacity200,d=o.greyOpacity100,S="icon-star-mono",u=(0,react_1.useRef)([]),g=(0,react_1.useRef)([]).current,k=ItemSizeBySize[r],R=(0,react_1.useRef)(i);R.current=i;const V=(t,e)=>{const{x:n,width:s}=t.nativeEvent.layout;g[e]={x:n,width:s}},m=(0,react_1.useCallback)(t=>{const{locationX:e}=t.nativeEvent;let n=0;for(let s=0;s<g.length;s++){const{x:_,width:E}=g[s];if(e>=_&&e<=_+E){n=s+1;break}else e>_+E?n=s+1:e<0&&(n=0)}return n},[g]),w=(0,react_1.useCallback)(t=>{const e=m(t);A?.(e),u.current.forEach((n,s)=>{s<e?n.activeMotion():n.inactiveMotion()})},[m,A]),q=(0,react_1.useCallback)(t=>{w(t),(0,generateHapticFeedback_js_1.generateHapticFeedback)({type:"tickMedium"});const e=m(t);u.current.forEach((n,s)=>{n.shrinkMotion(),s<e&&n.touchDownMotion()})},[m,w]),C=(0,react_1.useCallback)(()=>{u.current.forEach((t,e)=>{t.expandMotion(),e<R.current&&t.touchUpMotion()})},[]),D=(0,react_1.useRef)(react_native_1.PanResponder.create({onStartShouldSetPanResponder:()=>!0,onPanResponderGrant:q,onPanResponderMove:w,onPanResponderRelease:C,onPanResponderTerminate:C})).current,I={accessibilityRole:"text","aria-disabled":c,accessibilityHint:"\uBCC0\uACBD\uD560 \uC218 \uC5C6\uC5B4\uC694"},N={accessibilityRole:"adjustable",accessibilityActions:[{name:"increment",label:"\uBCC4\uC810 \uC62C\uB9AC\uAE30"},{name:"decrement",label:"\uBCC4\uC810 \uB0B4\uB9AC\uAE30"}],onAccessibilityAction:t=>{let e;switch(t.nativeEvent.actionName){case"increment":e=i!==b?i+1:i;break;case"decrement":e=i!==0?i-1:i;break;default:e=i;break}react_native_1.AccessibilityInfo.announceForAccessibility?.(`${e}\uC810\uC774 \uC120\uD0DD\uB418\uC5C8\uC2B5\uB2C8\uB2E4`),A?.(e)}};return(0,react_1.useEffect)(()=>{a&&u.current.forEach((t,e)=>{e<i?(t.activeMotion(),t.touchUpMotion()):t.inactiveMotion()})},[a,i]),(0,jsx_runtime_1.jsx)(react_native_1.View,{ref:M,accessible:!0,accessibilityLabel:x,accessibilityValue:{text:typeof p=="function"?p(b,i):p},...c?I:N,...c||a?{}:D.panHandlers,style:[Flex.rowCenter,{gap:v},j],testID:"rating",...h,children:Array.from({length:b},(t,e)=>(0,jsx_runtime_1.jsx)(EditableRatingItem,{ref:n=>{n&&(u.current[e]=n)},forwardedRef:M,size:k,onLayout:n=>V(n,e),active:e<i,activeColor:f,idleColor:l,disabledColor:d,disabled:c,name:S},e))})});const Position=react_native_1.StyleSheet.create({relative:{position:"relative"},overlap:{position:"absolute",top:0,left:0}}),ZIndex=react_native_1.StyleSheet.create({1:{zIndex:1},2:{zIndex:2},3:{zIndex:3}}),Flex=react_native_1.StyleSheet.create({rowCenter:{flexDirection:"row",alignItems:"center"}});
