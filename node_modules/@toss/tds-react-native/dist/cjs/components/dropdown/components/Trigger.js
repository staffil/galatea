"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Trigger=Trigger;const jsx_runtime_1=require("react/jsx-runtime"),tds_easings_1=require("@toss/tds-easings"),react_1=require("react"),react_native_1=require("react-native"),index_js_1=require("../../../core/index.js"),index_js_2=require("../../../interactions/rally/index.js"),z_index_js_1=require("../constants/z-index.js"),DropdownContext_js_1=require("../contexts/DropdownContext.js"),mergeRefs_js_1=require("../utils/mergeRefs.js"),FixedFloatingDropdown_js_1=require("./FixedFloatingDropdown.js");function ControlledTrigger({children:e,placement:t="bottom-start",strategy:n="absolute",...r}){const o=n==="fixed"?FixedFloatingDropdown_js_1.FixedFloatingDropdown:AbsoluteFloatingDropdown;return(0,jsx_runtime_1.jsx)(DropdownContext_js_1.DropdownProvider,{placement:t,children:(0,jsx_runtime_1.jsx)(o,{...r,children:e})})}function AbsoluteFloatingDropdown({children:e,onOpen:t,onClose:n,open:r,dropdown:o,containerStyle:l}){const{targetRef:s,dropdownBaseRef:a}=(0,DropdownContext_js_1.useDropdown)(),u=e.ref,d=(0,react_1.cloneElement)(e,{...e.props,ref:u!=null?(0,mergeRefs_js_1.mergeRefs)(u,s):s,onPress:()=>{r?n?.():t?.(),e.props?.onPress?.()}}),i=(0,index_js_1.useGlobalEvent)();return(0,react_1.useEffect)(()=>{const f=(c,g)=>{a?.current==null||c.target==null||!g&&!isInsideComponent(c.target,a.current)&&!isInsideComponent(c.target,s?.current)&&n?.()};return i.addEventListener("touchEnd",f),()=>{i.removeEventListener("touchEnd",f)}},[a,i,n,s]),(0,jsx_runtime_1.jsxs)(react_native_1.View,{style:[{position:"relative",zIndex:z_index_js_1.MENU_Z_INDEX},l],children:[d,(0,jsx_runtime_1.jsx)(index_js_2.AnimateRallyPresence,{children:r?(0,jsx_runtime_1.jsx)(FloatingOverlay,{children:o}):void 0})]})}function FloatingOverlay({style:e,children:t,...n}){const{targetRef:r,dropdownBaseRef:o,placement:l}=(0,DropdownContext_js_1.useDropdown)(),[s,a]=(0,react_1.useState)(null),[u,d]=(0,react_1.useState)(null);if((0,react_1.useEffect)(()=>{r?.current!=null&&o?.current!=null&&r.current.measureInWindow((f,c,g,_)=>{o?.current?.measureInWindow((x,h,p,m)=>{a({width:g,height:_}),d({width:p,height:m})})})},[o,r]),u==null||s==null)return(0,jsx_runtime_1.jsx)(react_native_1.View,{style:{opacity:0,position:"absolute",alignSelf:"flex-start"},children:t});const i=l==="bottom-start"?"left":"right";return(0,jsx_runtime_1.jsx)(jsx_runtime_1.Fragment,{children:(0,jsx_runtime_1.jsx)(index_js_2.Rally,{style:[{zIndex:9e3,position:"absolute",top:s.height},l==="bottom-start"?{left:0}:{right:0},e],exit:{opacity:{from:1,to:0},scale:{from:1,to:0},transformOriginX:{from:i,to:i},transformOriginY:{from:"top",to:"top"},easing:tds_easings_1.spring.medium},motion:{opacity:{from:0,to:1},scale:{from:0,to:1},transformOriginX:{from:i,to:i},transformOriginY:{from:"top",to:"top"},easing:tds_easings_1.spring.medium},...n,children:t})})}function UnControlledTrigger({defaultOpen:e=!1,onOpen:t,onClose:n,...r}){const[o,l]=(0,react_1.useState)(e),s=(0,react_1.useCallback)(()=>{t?.(),l(!0)},[t]),a=(0,react_1.useCallback)(()=>{n?.(),l(!1)},[n]);return(0,jsx_runtime_1.jsx)(ControlledTrigger,{open:o,onOpen:s,onClose:a,...r})}function Trigger(e){return e.open!=null?(0,jsx_runtime_1.jsx)(ControlledTrigger,{...e}):(0,jsx_runtime_1.jsx)(UnControlledTrigger,{...e})}Trigger.zIndex=z_index_js_1.MENU_Z_INDEX;const isInsideComponent=(e,t)=>{if(e&&t&&e._nativeTag===t._nativeTag)return!0;if(t._children&&t._children.length>0){for(let n=0;n<=t._children.length-1;n++)if(isInsideComponent(e,t._children[n]))return!0}return!1};
