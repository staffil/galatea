"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NumericSpinner=void 0;const jsx_runtime_1=require("react/jsx-runtime"),react_native_gesture_handler_1=require("@granite-js/native/react-native-gesture-handler"),tds_easings_1=require("@toss/tds-easings"),react_1=require("react"),react_native_1=require("react-native"),index_js_1=require("../../core/index.js"),index_js_2=require("../../interactions/animated/index.js"),generateHapticFeedback_js_1=require("../../native/generateHapticFeedback.js"),NumericSpinnerContainer_js_1=require("./NumericSpinnerContainer.js"),NumericSpinnerIconButton_js_1=require("./NumericSpinnerIconButton.js"),NumericSpinnerNumberBox_js_1=require("./NumericSpinnerNumberBox.js"),useAccelerateInterval_js_1=require("./useAccelerateInterval.js"),useButtonLongPress_js_1=require("./useButtonLongPress.js"),useWiggleMotion_js_1=require("./useWiggleMotion.js"),AnimatedNumericSpinnerContainer=index_js_2.Animated.createAnimatedComponent(NumericSpinnerContainer_js_1.NumericSpinnerContainer),AnimatedNumericSpinnerNumberBox=index_js_2.Animated.createAnimatedComponent(NumericSpinnerNumberBox_js_1.NumericSpinnerNumberBox),AnimatedNumericSpinnerMinusIconButton=index_js_2.Animated.createAnimatedComponent(NumericSpinnerIconButton_js_1.NumericSpinnerMinusIconButton),AnimatedNumericSpinnerPlusIconButton=index_js_2.Animated.createAnimatedComponent(NumericSpinnerIconButton_js_1.NumericSpinnerPlusIconButton),isNumberInRange=({min:t,max:n,num:e})=>!isNaN(e)&&e>=t&&e<=n;exports.NumericSpinner=(0,react_1.forwardRef)(function({disable:n,number:e=0,minNumber:a=0,maxNumber:s=100,onNumberChange:o,size:i,style:p,...k},S){const R=(0,index_js_1.useAdaptive)(),{play:u,style:V}=(0,useWiggleMotion_js_1.useWiggleMotion)(),g=isNumberInRange({max:s,min:a,num:e+1}),m=isNumberInRange({max:s,min:a,num:e-1}),y=(0,react_1.useCallback)(()=>{if(g){const r=e+1;(0,generateHapticFeedback_js_1.generateHapticFeedback)({type:"tickWeak"}),o?.(r);return}u()},[e,g,o,u]),E=(0,react_1.useCallback)(()=>{if(m){const r=e-1;(0,generateHapticFeedback_js_1.generateHapticFeedback)({type:"tickWeak"}),o?.(r);return}u()},[e,m,o,u]),h=useNumberTextAnimation(),{onPressStart:P,onPressEnd:w}=(0,useButtonLongPress_js_1.useButtonLongPress)({onPressing:E,onPressEnd:h.play}),{onPressStart:L,onPressEnd:M}=(0,useButtonLongPress_js_1.useButtonLongPress)({onPressing:y,onPressEnd:h.play}),c=(0,react_1.useRef)(!1),C=(0,useAccelerateInterval_js_1.useAccelerateInterval)(y,{startMs:400,interval:.8,minMs:50}),I=(0,useAccelerateInterval_js_1.useAccelerateInterval)(E,{startMs:400,interval:.8,minMs:50}),X=()=>{c.current!==!0&&(I.startInterval(),c.current=!0)},H=()=>{c.current!==!0&&(C.startInterval(),c.current=!0)},T=()=>{C.stopInterval(),I.stopInterval(),c.current=!1},b=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,l=(0,react_1.useRef)(new index_js_2.Animated.Value(NumericSpinnerNumberBox_js_1.NumericSpinnerNumberBoxBorderRadiusBySize[i])).current,v=useContainerAnimation({size:i}),F=index_js_2.Animated.event([{nativeEvent:{translationX:b}}],{useNativeDriver:!1}),G=r=>{switch(r.nativeEvent.state){case react_native_gesture_handler_1.State.BEGAN:{v.play(),index_js_2.Animated.parallel([index_js_2.Animated.timing(l,{toValue:50,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3})]).start();break}case react_native_gesture_handler_1.State.END:case react_native_gesture_handler_1.State.FAILED:{v.reset(),index_js_2.Animated.parallel([index_js_2.Animated.spring(b,{toValue:0,useNativeDriver:!1}),index_js_2.Animated.timing(l,{toValue:NumericSpinnerNumberBox_js_1.NumericSpinnerNumberBoxBorderRadiusBySize[i],useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3})]).start();break}}},[j,O]=(0,react_1.useState)(0),[f,$]=(0,react_1.useState)(0),[N,z]=(0,react_1.useState)(0),[x,J]=(0,react_1.useState)(0),q=b.interpolate({inputRange:[-N,x],outputRange:[-N,x],extrapolate:"clamp"});q.addListener(({value:r})=>{const K=-N;r===K?X():r===x?H():T()}),(0,react_1.useEffect)(()=>{l.setValue(NumericSpinnerNumberBox_js_1.NumericSpinnerNumberBoxBorderRadiusBySize[i])},[l,i]);const d=useNumberBoxAnimation(),A=useLeftIconButtonAnimation(),D=useRightIconButtonAnimation(),W=useLeftIconButtonPlaceholderAnimation(),B=useRightIconButtonPlaceholderAnimation(),_=`${e}`;return n?(0,jsx_runtime_1.jsx)(react_native_1.Pressable,{"aria-disabled":!0,accessibilityRole:"button",accessibilityLabel:`${e}, \uBCC0\uACBD\uD560 \uC218 \uC5C6\uC5B4\uC694`,testID:"numeric-spinner",onPress:()=>{u()},style:[{alignSelf:"flex-start"},p],...k,children:(0,jsx_runtime_1.jsxs)(AnimatedNumericSpinnerContainer,{ref:S,size:i,style:[{opacity:.3},V],pointerEvents:"none",children:[(0,jsx_runtime_1.jsx)(NumericSpinnerIconButton_js_1.NumericSpinnerMinusIconButton,{size:i}),(0,jsx_runtime_1.jsx)(NumericSpinnerNumberBox_js_1.NumericSpinnerNumberBox,{style:{borderRadius:8},size:i,"aria-label":_,color:h.style.color,children:e}),(0,jsx_runtime_1.jsx)(NumericSpinnerIconButton_js_1.NumericSpinnerPlusIconButton,{size:i})]})}):(0,jsx_runtime_1.jsxs)(AnimatedNumericSpinnerContainer,{testID:"numeric-spinner",ref:S,onLayout:r=>$(r.nativeEvent.layout.width),style:[{alignSelf:"flex-start"},{...v.style,transform:[...v.style.transform,...V.transform],position:"relative"},p],size:i,...k,children:[(0,jsx_runtime_1.jsx)(AnimatedNumericSpinnerMinusIconButton,{"aria-label":"\uBE7C\uAE30",accessibilityHint:m?"\uB450\uBC88 \uD130\uCE58\uD558\uBA74 \uC22B\uC790\uAC00 \uAC10\uC18C\uD574\uC694":`${a}\uAC1C \uC774\uD558\uB85C \uC120\uD0DD\uD560 \uC218 \uC5C6\uC5B4\uC694`,onLayout:r=>z(r.nativeEvent.layout.width),onPress:E,onPressIn:()=>{P(),d.shrink(),A.shrink(),W.shrink()},onPressOut:()=>{w(),d.expand(),A.expand(),W.expand()},disabled:m===!1,style:{zIndex:1,alignSelf:"stretch",...A.style},color:A.style.color,size:i}),(0,jsx_runtime_1.jsx)(react_native_gesture_handler_1.PanGestureHandler,{onGestureEvent:F,onHandlerStateChange:G,children:(0,jsx_runtime_1.jsx)(AnimatedNumericSpinnerNumberBox,{onLayout:r=>{O(r.nativeEvent.layout.width)},style:{zIndex:2,borderRadius:l,transform:[{translateX:q},...d.style.transform]},size:i,accessibilityRole:"text",accessibilityValue:{text:_},"aria-label":"\uD604\uC7AC \uAC12",accessibilityHint:"\uB450 \uBC88 \uD130\uCE58\uD558\uC5EC \uBCC0\uACBD\uD560 \uC218 \uC788\uC5B4\uC694",color:h.style.color,children:e})}),(0,jsx_runtime_1.jsx)(AnimatedNumericSpinnerPlusIconButton,{"aria-label":"\uB354\uD558\uAE30",accessibilityHint:g?"\uB450\uBC88 \uD130\uCE58\uD558\uBA74 \uC22B\uC790\uAC00 \uC99D\uAC00\uD574\uC694":`${s}\uAC1C \uC774\uC0C1 \uC120\uD0DD\uD560 \uC218 \uC5C6\uC5B4\uC694`,onLayout:r=>J(r.nativeEvent.layout.width),onPress:y,onPressIn:()=>{L(),d.shrink(),D.shrink(),B.shrink()},onPressOut:()=>{M(),d.expand(),D.expand(),B.expand()},disabled:g===!1,style:{zIndex:1,alignSelf:"stretch",...D.style},color:D.style.color,size:i}),(0,jsx_runtime_1.jsx)(index_js_2.Animated.View,{style:{position:"absolute",top:0,left:0,bottom:0,pointerEvents:"none",borderRadius:NumericSpinnerContainer_js_1.NumericSpinnerContainerBorderRadiusBySize[i],backgroundColor:R.greyOpacity100,width:Math.max(f-(f-j)/2+GapBySize[i],0),...W.style}}),(0,jsx_runtime_1.jsx)(index_js_2.Animated.View,{style:{position:"absolute",top:0,right:0,bottom:0,pointerEvents:"none",borderRadius:NumericSpinnerContainer_js_1.NumericSpinnerContainerBorderRadiusBySize[i],backgroundColor:R.greyOpacity100,width:Math.max(f-(f-j)/2+GapBySize[i],0),...B.style}})]})});const GapBySize={tiny:5,small:6,medium:7,large:8};function useContainerAnimation({size:t}){const n=(0,index_js_1.useAdaptive)(),e=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,a=e.interpolate({inputRange:[0,100],outputRange:[1,.96],extrapolate:"clamp"}),s=e.interpolate({inputRange:[0,100],outputRange:[n.grey100,n.grey200],extrapolate:"clamp"}),o=e.interpolate({inputRange:[0,100],outputRange:[NumericSpinnerContainer_js_1.NumericSpinnerContainerBorderRadiusBySize[t],50],extrapolate:"clamp"}),i=(0,react_1.useCallback)(()=>{index_js_2.Animated.timing(e,{toValue:100,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3}).start()},[e]),p=(0,react_1.useCallback)(()=>{index_js_2.Animated.timing(e,{toValue:0,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3}).start()},[e]);return{play:i,reset:p,style:{backgroundColor:s,borderRadius:o,transform:[{scale:a}]}}}function useNumberBoxAnimation(){const t=(0,react_1.useRef)(new index_js_2.Animated.Value(1)).current,n=(0,react_1.useCallback)(()=>{index_js_2.Animated.timing(t,{toValue:.9,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3}).start()},[t]),e=(0,react_1.useCallback)(()=>{index_js_2.Animated.timing(t,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.bounce.ease,duration:tds_easings_1.springEaseWithDuration.bounce.duration*1e3}).start()},[t]);return{shrink:n,expand:e,style:{transform:[{scale:t}]}}}function useLeftIconButtonAnimation(){const t=(0,index_js_1.useAdaptive)(),[n,e]=(0,react_1.useState)(t.grey700),a=(0,react_1.useRef)(new index_js_2.Animated.Value(1)).current,s=(0,react_1.useCallback)(()=>{index_js_2.Animated.timing(a,{toValue:.9,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}).start(),e(t.grey900)},[t.grey900,a]),o=(0,react_1.useCallback)(()=>{index_js_2.Animated.stagger(200,[index_js_2.Animated.timing(a,{toValue:1.1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}),index_js_2.Animated.timing(a,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.bounce.ease,duration:tds_easings_1.springEaseWithDuration.bounce.duration*1e3})]).start(),e(t.grey700)},[t.grey700,a]);return{shrink:s,expand:o,style:{transform:[{scale:a}],color:n}}}function useRightIconButtonAnimation(){const t=(0,index_js_1.useAdaptive)(),[n,e]=(0,react_1.useState)(t.grey700),a=(0,react_1.useRef)(new index_js_2.Animated.Value(1)).current,s=(0,react_1.useCallback)(()=>{index_js_2.Animated.timing(a,{toValue:.9,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}).start(),e(t.grey900)},[t.grey900,a]),o=(0,react_1.useCallback)(()=>{index_js_2.Animated.stagger(200,[index_js_2.Animated.timing(a,{toValue:1.1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}),index_js_2.Animated.timing(a,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.bounce.ease,duration:tds_easings_1.springEaseWithDuration.bounce.duration*1e3})]).start(),e(t.grey700)},[t.grey700,a]);return{shrink:s,expand:o,style:{transform:[{scale:a}],color:n}}}function useLeftIconButtonPlaceholderAnimation(){const t=(0,react_1.useRef)(new index_js_2.Animated.Value(1)).current,n=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,e=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,a=(0,react_1.useCallback)(()=>{index_js_2.Animated.parallel([index_js_2.Animated.timing(t,{toValue:.92,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}),index_js_2.Animated.timing(n,{toValue:-2,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}),index_js_2.Animated.timing(e,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3})]).start()},[e,t,n]),s=(0,react_1.useCallback)(()=>{index_js_2.Animated.parallel([index_js_2.Animated.timing(t,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3}),index_js_2.Animated.timing(n,{toValue:0,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3}),index_js_2.Animated.timing(e,{toValue:0,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3})]).start()},[e,t,n]);return{shrink:a,expand:s,style:{transform:[{scale:t},{translateX:n}],opacity:e}}}function useRightIconButtonPlaceholderAnimation(){const t=(0,react_1.useRef)(new index_js_2.Animated.Value(1)).current,n=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,e=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,a=(0,react_1.useCallback)(()=>{index_js_2.Animated.parallel([index_js_2.Animated.timing(t,{toValue:.92,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}),index_js_2.Animated.timing(n,{toValue:2,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}),index_js_2.Animated.timing(e,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3})]).start()},[e,t,n]),s=(0,react_1.useCallback)(()=>{index_js_2.Animated.parallel([index_js_2.Animated.timing(t,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3}),index_js_2.Animated.timing(n,{toValue:0,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.quick.ease,duration:tds_easings_1.springEaseWithDuration.quick.duration*1e3}),index_js_2.Animated.timing(e,{toValue:0,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3})]).start()},[e,t,n]);return{shrink:a,expand:s,style:{transform:[{scale:t},{translateX:n}],opacity:e}}}function useNumberTextAnimation(){const t=(0,index_js_1.useAdaptive)(),n=(0,react_1.useRef)(new index_js_2.Animated.Value(0)).current,e=n.interpolate({inputRange:[0,1],outputRange:[t.grey800,t.blue500]});return{play:(0,react_1.useCallback)(()=>{n.setValue(0),index_js_2.Animated.stagger(300,[index_js_2.Animated.timing(n,{toValue:1,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.rapid.ease,duration:tds_easings_1.springEaseWithDuration.rapid.duration*1e3}),index_js_2.Animated.timing(n,{toValue:0,useNativeDriver:!1,easing:tds_easings_1.springEaseWithDuration.basic.ease,duration:tds_easings_1.springEaseWithDuration.basic.duration*1e3})]).start()},[n]),style:{color:e}}}
