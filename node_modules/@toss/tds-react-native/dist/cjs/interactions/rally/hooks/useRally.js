"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.useRally=useRally;const react_1=require("react"),usePresence_js_1=require("../contexts/usePresence.js"),useAnimationController_js_1=require("./useAnimationController.js"),useRallyAnimation_js_1=require("./useRallyAnimation.js"),usePreservedReference_js_1=require("./utils/usePreservedReference.js");function useRally({playOnRender:c,exit:o,motion:u,defaultDuration:l,defaultEasing:f,applyBeforeMountedStyle:y=!0,...R}){const j=(0,usePreservedReference_js_1.usePreservedReference)(Array.isArray(u)?u:[u]),w=(0,usePreservedReference_js_1.usePreservedReference)(o??{}),[e,_]=(0,react_1.useState)({width:0,height:0,x:0,y:0}),s=e.width!==0||e.height!==0||e.x!==0||e.y!==0,m=(0,react_1.useCallback)(n=>{s||_(n.nativeEvent.layout)},[s]),{forward:h,backward:p,style:r}=(0,useRallyAnimation_js_1.useRallyAnimation)({motionInputs:j.map(n=>({easing:f,duration:l,...n})),layout:e}),i=(0,useRallyAnimation_js_1.useRallyAnimation)({motionInputs:[{easing:f,duration:l,...w}],layout:e}),t=(0,useAnimationController_js_1.useAnimationController)({forwardAnimation:h,backwardAnimation:p,mounted:s,...R}),{present:a,safeToRemove:d}=(0,usePresence_js_1.usePresence)({presence:o!==void 0});(0,react_1.useEffect)(()=>{async function n(){!a&&o&&await i.forward.start()&&d?.()}n()},[a,i.forward,d,o]),(0,react_1.useEffect)(()=>{c&&t.play()},[c,t.play,t]);const A=(0,react_1.useMemo)(()=>({...r,opacity:0,transform:[]}),[r]);return(0,react_1.useMemo)(()=>({...t,onLayout:m,style:s||!y?a?r:i.style:A}),[t,m,s,y,a,r,i.style,A])}
