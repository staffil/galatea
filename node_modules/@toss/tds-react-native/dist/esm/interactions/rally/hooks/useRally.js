"use strict";import{useCallback as E,useEffect as w,useMemo as h,useState as I}from"react";import{usePresence as L}from"../contexts/usePresence.js";import{useAnimationController as M}from"./useAnimationController.js";import{useRallyAnimation as A}from"./useRallyAnimation.js";import{usePreservedReference as b}from"./utils/usePreservedReference.js";export function useRally({playOnRender:m,exit:r,motion:c,defaultDuration:f,defaultEasing:u,applyBeforeMountedStyle:y=!0,...v}){const g=b(Array.isArray(c)?c:[c]),k=b(r??{}),[t,x]=I({width:0,height:0,x:0,y:0}),o=t.width!==0||t.height!==0||t.x!==0||t.y!==0,l=E(e=>{o||x(e.nativeEvent.layout)},[o]),{forward:R,backward:C,style:i}=A({motionInputs:g.map(e=>({easing:u,duration:f,...e})),layout:t}),s=A({motionInputs:[{easing:u,duration:f,...k}],layout:t}),n=M({forwardAnimation:R,backwardAnimation:C,mounted:o,...v}),{present:a,safeToRemove:d}=L({presence:r!==void 0});w(()=>{async function e(){!a&&r&&await s.forward.start()&&d?.()}e()},[a,s.forward,d,r]),w(()=>{m&&n.play()},[m,n.play,n]);const p=h(()=>({...i,opacity:0,transform:[]}),[i]);return h(()=>({...n,onLayout:l,style:o||!y?a?i:s.style:p}),[n,l,o,y,a,i,s.style,p])}
