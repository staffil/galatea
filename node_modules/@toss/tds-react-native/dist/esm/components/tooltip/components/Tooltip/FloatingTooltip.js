"use strict";import{jsx as e,jsxs as R}from"react/jsx-runtime";import{AnimateRallyPresence as k}from"../../../../interactions/rally/index.js";import{useAdaptive as O}from"../../../../core/index.js";import*as q from"../../../paragraph/index.js";import{cloneElement as z,forwardRef as b,useEffect as D,useMemo as I,useRef as G,useState as x}from"react";import{Dimensions as J,Pressable as K,StyleSheet as N,View as p}from"react-native";import{useTooltip as T}from"../../contexts/TooltipContext.js";import{useAnchorPosition as Q}from"../../hooks/useAnchorPosition.js";import{useOnPressOutside as U}from"../../hooks/useOnPressOutside.js";import{mergeRefs as A}from"../../utils/mergeRefs.js";import{Anchor as X}from"./Anchor.js";import{getTooltipStyle as Y,TooltipBase as Z}from"./TooltipBase.js";function H(f){return new Promise(r=>{f.measure((n,i,s,o)=>{r({width:s,height:o})})})}export const FloatingTooltip=b(function({open:r,children:n,...i},s){const{targetRef:o}=T(),l=n.ref,a=z(n,{...n.props,collapsable:!1,onPress:()=>{i.onChildrenPress?.(),n.props?.onPress?.()},ref:l!=null?A(l,o):o});return R(p,{style:{position:"relative",zIndex:9e3},children:[a,e(k,{children:r&&e(p,{style:[N.absoluteFill,{width:J.get("window").width}],pointerEvents:"box-none",children:e($,{ref:s,...i})})})]})});const $=b(function({message:r,messageAlign:n,placement:i,contentPositionByRatio:s,size:o="medium",motion:l,onPress:a,onPressOutside:W},v){const c=G(null),m=O(),{targetRef:y,offset:h}=T(),[u,F]=x(null),[d,S]=x(null),t=I(()=>Y(o),[o]),C=A(v,c),E=Q({anchorPositionByRatio:s,anchorWidth:t.anchorWidth,tooltipWidth:d?.width??0,size:o});return U({ref:c,onPressOutside:W}),D(()=>{function g(){const P=y?.current,w=c.current;P!=null&&w!=null&&h!=null&&(async()=>{const{width:L,height:_}=await H(P),{width:j,height:B}=await H(w),M=L/2-j/2,V=i==="top"?-B-h-t.anchorHeight:_+t.anchorHeight+h;F({left:M,top:V})})()}requestAnimationFrame(()=>{g()})},[y,i,t,h]),u==null||d==null?e(K,{ref:C,collapsable:!1,pointerEvents:"box-only",style:{opacity:0,position:"absolute",backgroundColor:m.floatBackground,borderRadius:t.borderRadius,paddingHorizontal:t.paddingHorizontal/2,paddingVertical:t.paddingVertical/2},onLayout:g=>{S(g.nativeEvent.layout)},onPress:a,children:R(p,{children:[e(p,{style:{position:"absolute",width:t.anchorWidth,height:t.anchorHeight},children:e(X,{size:o})}),e(q.Text,{typography:t.typography,color:m.grey800,fontWeight:t.fontWeight,children:r})]})}):e(Z,{ref:c,size:o,placement:i,messageAlign:n,message:r,motion:l,left:u.left,top:u.top,contentHeight:d.height,anchorMarginLeft:E,onPress:a})});
